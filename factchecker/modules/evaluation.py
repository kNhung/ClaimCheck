from modules.llm import prompt_ollama

judge_prompt = """
Hướng dẫn
Xác định tính đúng/sai của Phát biểu theo các bước:
1) Tóm tắt ngắn gọn (tối đa một đoạn) các ý chính từ quá trình kiểm chứng (xem Record).
2) Viết một đoạn giải thích lựa chọn nào trong Decision Options là phù hợp nhất. Ở cuối đoạn, chèn đúng một nhãn lựa chọn trong dấu backticks như `this`.

Lưu ý kỹ thuật:
- Các Decision Options được giữ nguyên tiếng Anh. Hãy đảm bảo đưa đúng một nhãn nằm trong danh sách này và đặt trong backticks.

Decision Options:
{options}

Rules:
{rules}

Record:
{record}
Your Judgement:
"""

verdict_extraction_prompt = """
Hướng dẫn
Bạn là người kiểm chứng. Nhiệm vụ là trích xuất phán quyết (verdict) từ phần kết luận. Chỉ trả về một nhãn duy nhất, nằm trong các lựa chọn sau:

Decision Options:
{options}

Rules:
{rules}

Conclusion:
{conclusion}
Extracted Verdict:
"""

def judge(record, decision_options, rules="", think=True):
    """
    Determines the veracity of a claim based on the provided record and decision options.

    Args:
        record (str): The record containing evidence for the judgement.
        decision_options (str): The available decision options to choose from.
        extra_rules (str): Additional rules to consider in the judgement.
        think (bool): Whether to use chain-of-thought (default True)
    Returns:
        str: The judgement generated by the LLM.
    """
    prompt = judge_prompt.format(record=record, options=decision_options, rules=rules)
    return prompt_ollama(prompt, think=think)

def extract_verdict(conclusion, decision_options, rules=""):
    """
    Extracts the verdict from the conclusion of a fact-check.

    Args:
        conclusion (str): The conclusion text from which to extract the verdict.
        decision_options (str): The available decision options to choose from.
        rules (str): Additional rules to consider in the extraction.
    
    Returns:
        str: The extracted verdict.
    """
    prompt = verdict_extraction_prompt.format(conclusion=conclusion, options=decision_options, rules=rules)
    return prompt_ollama(prompt, think=False)